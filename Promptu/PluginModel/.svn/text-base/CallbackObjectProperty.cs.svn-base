using System;
using System.Collections.Generic;
using System.Text;
using System.ComponentModel;

namespace ZachJohnson.Promptu.PluginModel
{
    public class CallbackObjectProperty<T> : ObjectProperty<T>
    {
        private Getter<T> getter;
        private Setter<T> setter;

        public CallbackObjectProperty(
            string id,
            string label,
            Getter<T> getter,
            Setter<T> setter,
            IPropertyEditorFactory editorFactory,
            object conversionInfo)
            //TypeConverter typeConverter)
            : base(
                id,
                label,
                editorFactory,
                conversionInfo)
                //typeConverter)
        {
            if (getter == null)
            {
                throw new ArgumentNullException("getter");
            }
            else if (setter == null)
            {
                throw new ArgumentNullException("setter");
            }

            this.getter = getter;
            this.setter = setter;
        }

        protected override void Dispose(bool disposing)
        {
            base.Dispose(disposing);
            this.getter = null;
            this.setter = null;
        }

        protected override T GetValueCore()
        {
            return this.getter();
        }

        protected override void SetValueCore(T value)
        {
            //T obj;
            //try
            //{
            //    obj = value;
            //}
            //catch (InvalidCastException)
            //{
            //    return;
            //}

            this.setter(value);
        }
    }
}
